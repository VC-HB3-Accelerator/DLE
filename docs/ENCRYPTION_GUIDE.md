<!--
  Copyright (c) 2024-2025 –¢–∞—Ä–∞–±–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á
  All rights reserved.
  
  This software is proprietary and confidential.
  Unauthorized copying, modification, or distribution is prohibited.
  
  For licensing inquiries: info@hb3-accelerator.com
  Website: https://hb3-accelerator.com
  GitHub: https://github.com/HB3-ACCELERATOR
-->

# üîê –ü–æ–ª–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ DLE

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —à–∏—Ñ—Ä—É–µ—Ç **–í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤–æ **–í–°–ï–• —Ç–∞–±–ª–∏—Ü–∞—Ö** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## üéØ –ß—Ç–æ —à–∏—Ñ—Ä—É–µ—Ç—Å—è

### **‚úÖ –í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤–æ –í–°–ï–• —Ç–∞–±–ª–∏—Ü–∞—Ö:**
- `text` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
- `varchar` - —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
- `character varying` - —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
- `json` - JSON –¥–∞–Ω–Ω—ã–µ
- `jsonb` - –±–∏–Ω–∞—Ä–Ω—ã–µ JSON –¥–∞–Ω–Ω—ã–µ

### **‚ùå –ù–ï —à–∏—Ñ—Ä—É—é—Ç—Å—è:**
- `id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
- `created_at`, `updated_at` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- `integer`, `numeric`, `boolean` - —á–∏—Å–ª–æ–≤—ã–µ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã
- –ö–æ–ª–æ–Ω–∫–∏, —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ `_encrypted` –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### **–®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**
```bash
chmod +x encrypt-all-tables.sh
./encrypt-all-tables.sh
```

### **–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**
```bash
./decrypt-all-tables.sh
```

### **–®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

#### **A. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞**
```javascript
const encryptedDataService = require('./services/encryptedDataService');

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π
const users = await encryptedDataService.getData('users', { role: 'admin' });

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
const newUser = await encryptedDataService.saveData('users', {
  name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
  email: 'ivan@example.com',
  preferences: { theme: 'dark' }
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
const updatedUser = await encryptedDataService.saveData('users', 
  { name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤' }, 
  { id: 1 }
);

// –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
await encryptedDataService.deleteData('users', { id: 1 });
```

#### **B. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**
```javascript
const status = await encryptedDataService.getEncryptionStatus();
console.log('–°—Ç–∞—Ç—É—Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:', status);
// {
//   hasEncryptionKey: true,
//   encryptedTables: [
//     { table_name: 'users', encrypted_columns: '3' },
//     { table_name: 'messages', encrypted_columns: '2' }
//   ],
//   totalEncryptedColumns: 15
// }
```

### **–®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–æ—É—Ç–æ–≤**

#### **–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–æ—É—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```javascript
// –ë—ã–ª–æ:
router.get('/users', async (req, res) => {
  const { rows } = await db.getQuery()('SELECT * FROM users');
  res.json(rows);
});

// –°—Ç–∞–ª–æ:
router.get('/users', async (req, res) => {
  try {
    const users = await encryptedDataService.getData('users');
    res.json(users);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

#### **–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–æ—É—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**
```javascript
// –ë—ã–ª–æ:
router.post('/messages', async (req, res) => {
  const { content, user_id } = req.body;
  const { rows } = await db.getQuery()(
    'INSERT INTO messages (content, user_id) VALUES ($1, $2) RETURNING *',
    [content, user_id]
  );
  res.json(rows[0]);
});

// –°—Ç–∞–ª–æ:
router.post('/messages', async (req, res) => {
  try {
    const { content, user_id } = req.body;
    const message = await encryptedDataService.saveData('messages', {
      content,
      user_id
    });
    res.json(message);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

### **–®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
curl -X GET http://localhost:8000/api/users
curl -X POST http://localhost:8000/api/messages -H "Content-Type: application/json" -d '{"content":"–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ","user_id":1}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É
./decrypt-all-tables.sh
```

### **–®–∞–≥ 6: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫**
```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è!
./remove-unencrypted-columns.sh
```

## üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏

### **–ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**
- **–§–∞–π–ª**: `./ssl/keys/full_db_encryption.key`
- **–†–∞–∑–º–µ—Ä**: 32 –±–∞–π—Ç–∞ (base64)
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: AES-256-CBC

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞**
```bash
# –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
chmod 600 ./ssl/keys/full_db_encryption.key

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
cp ./ssl/keys/full_db_encryption.key ./ssl/keys/full_db_encryption.key.backup

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
sha256sum ./ssl/keys/full_db_encryption.key
```

## üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### **1. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–º–æ–≤ Docker**
```yaml
# docker-compose.yml
volumes:
  postgres_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /path/to/encrypted/storage
```

### **2. SSL/TLS –¥–ª—è PostgreSQL**
```yaml
# docker-compose.yml
services:
  postgres:
    command: >
      postgres
      -c ssl=on
      -c ssl_cert_file=/etc/ssl/certs/server.crt
      -c ssl_key_file=/etc/ssl/certs/server.key
```

### **3. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# –î–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
./encrypt-env.sh
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞—É–¥–∏—Ç

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º**
```javascript
// –í —Å–µ—Ä–≤–∏—Å–µ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
console.log(`üîê –î–æ—Å—Ç—É–ø –∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º: ${tableName} –≤ ${new Date().toISOString()}`);
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏**
```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
./verify-encryption.sh
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### **1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ/—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

### **2. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –•—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥–∞–Ω–Ω—ã—Ö

### **3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
docker exec dapp-postgres psql -U dapp_user -d dapp_db < backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞
cp ./ssl/keys/full_db_encryption.key.backup ./ssl/keys/full_db_encryption.key
```

### **4. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- Fallback –Ω–∞ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–ª—é—á–∞
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ –í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ –ë–î
- ‚úÖ –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Fallback –Ω–∞ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–ª—é—á–∞
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–æ—Ç–∞—Ü–∏–∏ –∫–ª—é—á–µ–π

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!** üîí 