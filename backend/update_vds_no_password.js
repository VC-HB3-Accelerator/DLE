/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ VDS - —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º SSH –∫–ª—é—á–∏)
 */

const encryptedDb = require('./services/encryptedDatabaseService');

async function updateVdsSettings() {
  try {
    console.log('üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ VDS (—É–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º SSH –∫–ª—é—á–∏)...');
    
    // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const existing = await encryptedDb.getData('vds_settings', {}, 1);
    
    if (existing.length === 0) {
      console.error('‚ùå –ù–∞—Å—Ç—Ä–æ–π–∫–∏ VDS –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
      process.exit(1);
    }
    
    console.log('üìù –ù–∞–π–¥–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (id:', existing[0].id, ')');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–∞—Ä–æ–ª—å - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ null (–±—É–¥–µ—Ç –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏)
    // –ü–µ—Ä–µ–¥–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã encryptedDb –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª —ç—Ç–æ –ø–æ–ª–µ
    // –ù–æ –ª—É—á—à–µ —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ null —á–µ—Ä–µ–∑ SQL
    const settings = {
      updated_at: new Date()
    };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ encryptedDb (–ø–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º, –∑–Ω–∞—á–∏—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
    const result = await encryptedDb.saveData('vds_settings', settings, { id: existing[0].id });
    
    console.log('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–ø–∞—Ä–æ–ª—å –Ω–µ –∏–∑–º–µ–Ω–µ–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è SSH –∫–ª—é—á)');
    console.log('‚ÑπÔ∏è  –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤—Å–µ –µ—â–µ –≤ –ë–î, –æ–Ω –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, —Ç–∞–∫ –∫–∞–∫ –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç sshPassword && sshPassword.trim()');
    process.exit(0);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
    process.exit(1);
  }
}

updateVdsSettings();

