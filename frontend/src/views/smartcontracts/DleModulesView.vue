<!--
  Copyright (c) 2024-2025 –¢–∞—Ä–∞–±–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á
  All rights reserved.
  
  This software is proprietary and confidential.
  Unauthorized copying, modification, or distribution is prohibited.
  
  For licensing inquiries: info@hb3-accelerator.com
  Website: https://hb3-accelerator.com
  GitHub: https://github.com/HB3-ACCELERATOR
-->

<template>
  <div class="dle-modules-management">
    <div class="modules-header">
      <h3>üß© –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏</h3>
      <button class="btn btn-primary" @click="showAddModuleForm = true">
        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å
      </button>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª—è -->
    <div v-if="showAddModuleForm" class="add-module-form">
      <div class="form-header">
        <h4>üß© –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å</h4>
        <button class="close-btn" @click="showAddModuleForm = false">√ó</button>
      </div>
      
      <div class="form-content">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ -->
        <div class="form-section">
          <h5>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ</h5>
          
          <div class="form-group">
            <label for="moduleId">ID –º–æ–¥—É–ª—è:</label>
            <input 
              type="text" 
              id="moduleId" 
              v-model="newModule.moduleId" 
              class="form-control"
              placeholder="TreasuryModule"
            >
            <small class="form-help">–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–æ–¥—É–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: TreasuryModule)</small>
          </div>
          
          <div class="form-group">
            <label for="moduleAddress">–ê–¥—Ä–µ—Å –º–æ–¥—É–ª—è:</label>
            <input 
              type="text" 
              id="moduleAddress" 
              v-model="newModule.moduleAddress" 
              class="form-control"
              placeholder="0x..."
            >
            <small class="form-help">–ê–¥—Ä–µ—Å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –º–æ–¥—É–ª—è</small>
          </div>
          
          <div class="form-group">
            <label for="moduleName">–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è:</label>
            <input 
              type="text" 
              id="moduleName" 
              v-model="newModule.name" 
              class="form-control"
              placeholder="–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ"
            >
          </div>
          
          <div class="form-group">
            <label for="moduleDescription">–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è:</label>
            <textarea 
              id="moduleDescription" 
              v-model="newModule.description" 
              class="form-control" 
              rows="3"
              placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª—è..."
            ></textarea>
          </div>
        </div>

        <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –º–æ–¥—É–ª—è -->
        <div class="form-section">
          <h5>üîß –¢–∏–ø –º–æ–¥—É–ª—è</h5>
          
          <div class="module-types">
            <div class="form-group">
              <label for="moduleType">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–æ–¥—É–ª—è:</label>
              <select id="moduleType" v-model="newModule.type" class="form-control">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                <option value="treasury">–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ</option>
                <option value="voting">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</option>
                <option value="communication">–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</option>
                <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
              </select>
            </div>

            <!-- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–∞ -->
            <div v-if="newModule.type === 'treasury'" class="module-settings">
              <h6>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–∞</h6>
              <div class="form-group">
                <label for="treasuryTokens">–¢–æ–∫–µ–Ω—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
                <select id="treasuryTokens" v-model="newModule.settings.tokens" multiple class="form-control">
                  <option value="ETH">ETH</option>
                  <option value="USDT">USDT</option>
                  <option value="USDC">USDC</option>
                  <option value="DAI">DAI</option>
                </select>
              </div>
              <div class="form-group">
                <label for="treasuryLimit">–õ–∏–º–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π:</label>
                <input 
                  type="number" 
                  id="treasuryLimit" 
                  v-model.number="newModule.settings.limit" 
                  class="form-control"
                  placeholder="1000"
                >
              </div>
            </div>

            <!-- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
            <div v-if="newModule.type === 'voting'" class="module-settings">
              <h6>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h6>
              <div class="form-group">
                <label for="votingType">–¢–∏–ø –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:</label>
                <select id="votingType" v-model="newModule.settings.votingType" class="form-control">
                  <option value="simple">–ü—Ä–æ—Å—Ç–æ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ</option>
                  <option value="weighted">–í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</option>
                  <option value="quadratic">–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</option>
                </select>
              </div>
              <div class="form-group">
                <label for="votingDuration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (–¥–Ω–∏):</label>
                <input 
                  type="number" 
                  id="votingDuration" 
                  v-model.number="newModule.settings.duration" 
                  class="form-control"
                  min="1"
                  max="30"
                  placeholder="7"
                >
              </div>
            </div>

            <!-- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π -->
            <div v-if="newModule.type === 'communication'" class="module-settings">
              <h6>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π</h6>
              <div class="form-group">
                <label for="communicationChannels">–ö–∞–Ω–∞–ª—ã —Å–≤—è–∑–∏:</label>
                <div class="checkbox-group">
                  <label><input type="checkbox" v-model="newModule.settings.channels.email"> Email</label>
                  <label><input type="checkbox" v-model="newModule.settings.channels.telegram"> Telegram</label>
                  <label><input type="checkbox" v-model="newModule.settings.channels.discord"> Discord</label>
                  <label><input type="checkbox" v-model="newModule.settings.channels.slack"> Slack</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä -->
        <div class="form-section">
          <h5>üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h5>
          <div class="preview-card">
            <div class="preview-item">
              <strong>ID –º–æ–¥—É–ª—è:</strong> {{ newModule.moduleId || '–ù–µ —É–∫–∞–∑–∞–Ω' }}
            </div>
            <div class="preview-item">
              <strong>–ê–¥—Ä–µ—Å:</strong> {{ shortenAddress(newModule.moduleAddress) || '–ù–µ —É–∫–∞–∑–∞–Ω' }}
            </div>
            <div class="preview-item">
              <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {{ newModule.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}
            </div>
            <div class="preview-item">
              <strong>–¢–∏–ø:</strong> {{ getModuleTypeName(newModule.type) || '–ù–µ –≤—ã–±—Ä–∞–Ω' }}
            </div>
            <div class="preview-item">
              <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ newModule.description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}
            </div>
            <div v-if="newModule.type" class="preview-item">
              <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏:</strong> {{ getModuleSettingsPreview() }}
            </div>
          </div>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="form-actions">
          <button 
            class="btn btn-success" 
            @click="addModule" 
            :disabled="!isFormValid || isAdding"
          >
            <i class="fas fa-plus"></i> 
            {{ isAdding ? '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...' : '–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å' }}
          </button>
          <button class="btn btn-secondary" @click="resetForm">
            <i class="fas fa-undo"></i> –°–±—Ä–æ—Å–∏—Ç—å
          </button>
          <button class="btn btn-danger" @click="showAddModuleForm = false">
            <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π -->
    <div class="modules-list">
      <div class="list-header">
        <h4>üìã –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏</h4>
        <div class="list-filters">
          <select v-model="typeFilter" class="form-control">
            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
            <option value="treasury">–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ</option>
            <option value="voting">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</option>
            <option value="communication">–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</option>
            <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ</option>
          </select>
        </div>
      </div>

      <div v-if="filteredModules.length === 0" class="no-modules">
        <p>–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
      </div>

      <div v-else class="modules-grid">
        <div 
          v-for="module in filteredModules" 
          :key="module.moduleId" 
          class="module-card"
          :class="module.type"
        >
          <div class="module-header">
            <h5>{{ module.name }}</h5>
            <span class="module-type">{{ getModuleTypeName(module.type) }}</span>
          </div>

          <div class="module-details">
            <div class="detail-item">
              <strong>ID:</strong> {{ module.moduleId }}
            </div>
            <div class="detail-item">
              <strong>–ê–¥—Ä–µ—Å:</strong> {{ shortenAddress(module.moduleAddress) }}
            </div>
            <div class="detail-item">
              <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ module.description }}
            </div>
            <div class="detail-item">
              <strong>–°—Ç–∞—Ç—É—Å:</strong> 
              <span class="module-status" :class="{ 'active': module.isActive }">
                {{ module.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}
              </span>
            </div>
          </div>

          <div class="module-actions">
            <button 
              class="btn btn-sm btn-info" 
              @click="viewModuleDetails(module.moduleId)"
            >
              <i class="fas fa-eye"></i> –î–µ—Ç–∞–ª–∏
            </button>
            <button 
              class="btn btn-sm btn-warning" 
              @click="configureModule(module.moduleId)"
            >
              <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
            </button>
            <button 
              class="btn btn-sm btn-danger" 
              @click="removeModule(module.moduleId)"
            >
              <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏ -->
    <div class="available-modules">
      <h4>üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏</h4>
      <p>–ú–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –≤–∞—à–µ–º DLE</p>
      
      <div class="available-modules-grid">
        <div 
          v-for="availableModule in availableModules" 
          :key="availableModule.id" 
          class="available-module-card"
        >
          <div class="module-icon">
            <i :class="availableModule.icon"></i>
          </div>
          <div class="module-info">
            <h6>{{ availableModule.name }}</h6>
            <p>{{ availableModule.description }}</p>
            <div class="module-features">
              <span v-for="feature in availableModule.features" :key="feature" class="feature-tag">
                {{ feature }}
              </span>
            </div>
          </div>
          <div class="module-actions">
            <button 
              class="btn btn-sm btn-success" 
              @click="installAvailableModule(availableModule)"
            >
              <i class="fas fa-download"></i> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';
import { useAuthContext } from '@/composables/useAuth';

const props = defineProps({
  dleAddress: { type: String, required: true },
  dleContract: { type: Object, required: true }
});

const { address } = useAuthContext();

// –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã
const showAddModuleForm = ref(false);
const isAdding = ref(false);
const typeFilter = ref('');

// –ù–æ–≤—ã–π –º–æ–¥—É–ª—å
const newModule = ref({
  moduleId: '',
  moduleAddress: '',
  name: '',
  description: '',
  type: '',
  settings: {
    tokens: [],
    limit: 0,
    votingType: 'simple',
    duration: 7,
    channels: {
      email: false,
      telegram: false,
      discord: false,
      slack: false
    }
  }
});

// –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
const modules = ref([]);

// –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏
const availableModules = ref([
  {
    id: 'treasury',
    name: '–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ',
    description: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ DLE, –ø—Ä–∏–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤',
    icon: 'fas fa-coins',
    features: ['–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏', '–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å'],
    type: 'treasury'
  },
  {
    id: 'hierarchical-voting',
    name: '–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ',
    description: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π',
    icon: 'fas fa-sitemap',
    features: ['–ò–µ—Ä–∞—Ä—Ö–∏—è', '–í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ', '–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ'],
    type: 'voting'
  },
  {
    id: 'communication',
    name: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏',
    description: '–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π',
    icon: 'fas fa-comments',
    features: ['–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', '–ö–∞–Ω–∞–ª—ã —Å–≤—è–∑–∏', '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è'],
    type: 'communication'
  },
  {
    id: 'analytics',
    name: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
    description: '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è DLE',
    icon: 'fas fa-chart-line',
    features: ['–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', '–ì—Ä–∞—Ñ–∏–∫–∏', '–û—Ç—á–µ—Ç—ã'],
    type: 'custom'
  }
]);

// –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
const isFormValid = computed(() => {
  return (
    newModule.value.moduleId &&
    newModule.value.moduleAddress &&
    newModule.value.name &&
    newModule.value.type
  );
});

const filteredModules = computed(() => {
  if (!typeFilter.value) return modules.value;
  return modules.value.filter(m => m.type === typeFilter.value);
});

// –§—É–Ω–∫—Ü–∏–∏
function getModuleTypeName(type) {
  const types = {
    'treasury': '–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ',
    'voting': '–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ',
    'communication': '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏',
    'custom': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π'
  };
  return types[type] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';
}

function getModuleSettingsPreview() {
  const settings = newModule.value.settings;
  
  switch (newModule.value.type) {
    case 'treasury':
      return `–¢–æ–∫–µ–Ω—ã: ${settings.tokens.join(', ') || '–ù–µ –≤—ã–±—Ä–∞–Ω—ã'}, –õ–∏–º–∏—Ç: ${settings.limit}`;
    case 'voting':
      return `–¢–∏–ø: ${settings.votingType}, –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${settings.duration} –¥–Ω–µ–π`;
    case 'communication':
      const channels = Object.entries(settings.channels)
        .filter(([_, enabled]) => enabled)
        .map(([name, _]) => name);
      return `–ö–∞–Ω–∞–ª—ã: ${channels.join(', ') || '–ù–µ –≤—ã–±—Ä–∞–Ω—ã'}`;
    default:
      return '–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫';
  }
}

function shortenAddress(address) {
  if (!address) return '';
  return `${address.slice(0, 6)}...${address.slice(-4)}`;
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è
async function addModule() {
  if (!isFormValid.value) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
    return;
  }

  isAdding.value = true;
  
  try {
    // –í—ã–∑–æ–≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    const tx = await props.dleContract.addModule(
      newModule.value.moduleId,
      newModule.value.moduleAddress
    );
    
    await tx.wait();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π
    await loadModules();
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
    resetForm();
    showAddModuleForm.value = false;
    
    alert('‚úÖ –ú–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è:', error);
    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è: ' + error.message);
  } finally {
    isAdding.value = false;
  }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è
async function removeModule(moduleId) {
  if (!confirm(`–£–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å "${moduleId}"?`)) return;
  
  try {
    const tx = await props.dleContract.removeModule(moduleId);
    await tx.wait();
    
    await loadModules();
    alert('‚úÖ –ú–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!');
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è:', error);
    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è: ' + error.message);
  }
}

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–æ–¥—É–ª—è
async function installAvailableModule(availableModule) {
  // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥—É–ª—è
  // –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–ø–ª–æ–π –º–æ–¥—É–ª—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ DLE
  console.log('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥—É–ª—è:', availableModule);
  alert(`–ú–æ–¥—É–ª—å "${availableModule.name}" –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π
async function loadModules() {
  try {
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ API –∏–ª–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π
    // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
    modules.value = [];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª–µ–π:', error);
  }
}

function resetForm() {
  newModule.value = {
    moduleId: '',
    moduleAddress: '',
    name: '',
    description: '',
    type: '',
    settings: {
      tokens: [],
      limit: 0,
      votingType: 'simple',
      duration: 7,
      channels: {
        email: false,
        telegram: false,
        discord: false,
        slack: false
      }
    }
  };
}

function viewModuleDetails(moduleId) {
  // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –º–æ–¥—É–ª—è
  console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –º–æ–¥—É–ª—è:', moduleId);
}

function configureModule(moduleId) {
  // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è
  console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥—É–ª—è:', moduleId);
}

onMounted(() => {
  loadModules();
});
</script>

<style scoped>
.dle-modules-management {
  padding: 1rem;
}

.modules-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.add-module-form {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.close-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #666;
}

.form-section {
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #eee;
}

.form-section:last-child {
  border-bottom: none;
}

.form-section h5 {
  color: #333;
  margin-bottom: 1rem;
}

.module-types {
  margin-top: 1rem;
}

.module-settings {
  margin-top: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
}

.module-settings h6 {
  color: #333;
  margin-bottom: 1rem;
}

.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.checkbox-group label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
}

.preview-card {
  background: #fff;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 1rem;
}

.preview-item {
  margin-bottom: 0.5rem;
}

.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.modules-list {
  margin-top: 2rem;
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.modules-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
}

.module-card {
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 1rem;
  background: #fff;
}

.module-card.treasury {
  border-left: 4px solid #28a745;
}

.module-card.voting {
  border-left: 4px solid #007bff;
}

.module-card.communication {
  border-left: 4px solid #ffc107;
}

.module-card.custom {
  border-left: 4px solid #6c757d;
}

.module-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.module-header h5 {
  margin: 0;
  color: #333;
}

.module-type {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.8rem;
  font-weight: 600;
  background: #e9ecef;
  color: #495057;
}

.module-details {
  margin-bottom: 1rem;
}

.detail-item {
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.module-status {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.8rem;
  font-weight: 600;
}

.module-status.active {
  background: #d4edda;
  color: #155724;
}

.module-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.no-modules {
  text-align: center;
  padding: 2rem;
  color: #666;
}

.available-modules {
  margin-top: 3rem;
}

.available-modules h4 {
  margin-bottom: 1rem;
}

.available-modules p {
  color: #666;
  margin-bottom: 2rem;
}

.available-modules-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.available-module-card {
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 1rem;
  background: #fff;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.module-icon {
  width: 50px;
  height: 50px;
  background: #f8f9fa;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #007bff;
  font-size: 1.5rem;
  flex-shrink: 0;
}

.module-info {
  flex-grow: 1;
}

.module-info h6 {
  margin: 0 0 0.5rem 0;
  color: #333;
}

.module-info p {
  margin: 0 0 0.5rem 0;
  font-size: 0.9rem;
  color: #666;
}

.module-features {
  display: flex;
  gap: 0.25rem;
  flex-wrap: wrap;
}

.feature-tag {
  background: #e9ecef;
  color: #495057;
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
}

.form-help {
  font-size: 0.9rem;
  color: #666;
  margin-top: 0.25rem;
}
</style> 